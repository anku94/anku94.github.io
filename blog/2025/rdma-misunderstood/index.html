<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="3ec0Ti5C7XRZ9uYFYQwJWhUPAB4Hr4GvDqj1HRAcSFg"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Is RDMA Misunderstood? | Ankush Jain</title> <meta name="author" content="Ankush Jain"> <meta name="description" content="Do we keep doing repeating certain things in academic work on HPC fabrics?"> <meta name="keywords" content="systems, hpc, storage, networks, performance, linux"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ankushja.in/blog/2025/rdma-misunderstood/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/monokai.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Ankush Jain</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Is RDMA Misunderstood?</h1> <p class="post-meta">October 6, 2025</p> <p class="post-tags"> <a href="/blog/2025"> <i class="fas fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/infiniband"> <i class="fas fa-hashtag fa-sm"></i> infiniband</a>     ·   <a href="/blog/category/systems"> <i class="fas fa-tag fa-sm"></i> systems</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>In this post, I explore the thesis that we keep redoing certain things in fabric design because the history is not properly documented. It is an ambitious claim, and the understanding I need to build to make it comprehensively and conclusively remains elusive, and this is an attempt at a sloppier fail-fast version. Let me reiterate the <em>fail-fast</em> bit: this post was written with an appetite for my own hat. It also forms a loose series with <a href="https://ankushja.in/blog/2023/infiniband-flavors/">this</a>, <a href="https://ankushja.in/blog/2024/network-tradeoffs/">this</a>, and <a href="https://ankushja.in/blog/2024/credits-flow-congestion/">this</a>.</p> <p>Edit: <em>I prompt-engineered some LLMs into generating <a href="https://users.ece.cmu.edu/~ankushj/cbfc.pdf" rel="external nofollow noopener" target="_blank">this</a>. Same reliability caveats as the rest of the post apply.</em></p> <h2 id="losslessless-the-bedrock-of-rdma">Losslessless: The Bedrock of RDMA</h2> <p>RDMA originated on a natively lossless fabric (Infiniband). Since then, we have tried to graft it into inherently lossy fabrics, with brittle outcomes. We like losslessness for the same reason we like strong consistency: it is nice and simple if things just work and are predictable.</p> <ol> <li>Every network becomes lossless at low utilization.</li> <li>CBFC is the best way we know to build a lossless network at higher traffic volumes. PFC is very fragile, intrinsically so.</li> <li>CBFC and PFC represent two fundamentally differing approaches to utilization management: proactive and reactive, with their own tradeoffs. The cost of a proactive approach is <em>“imposing flow control when it was unnecessary”</em>, leading to potential underutilization.</li> <li>There is a fundamental tradeoff between network utilization and loss guarantees. For any given lossless network, you can afford to be a little speculative and increase median usage. The null hypothesis is that this increases loss probability. Unless reasoned all the way through and demonstrated to not exist or not be a factor, it must exist.</li> <li>We like lossless networks because in certain conditions, the cost of loss to higher layers is prohibitive. We should not design lossless schemes that dispatch speculatively without reasoning about why we wanted a lossless scheme in the first place, and why that speculative dispatch does not create problems we wanted to avoid<sup id="fnref:2"><a href="#fn:2" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>.</li> </ol> <h2 id="everyone-likes-most-of-infiniband">Everyone Likes Most of Infiniband</h2> <p>Let us disaggregate infiniband into a series of features.</p> <p>Likes:</p> <ol> <li>Everyone likes CBFC[^1,2,3]</li> <li>Everyone likes the performance benefits of RDMA, if not the complexity of memory registration and coding verbs.</li> </ol> <p>Dislikes:</p> <ol> <li>Everyone dislikes its difficult relationship with the broader datacenter network. It is not a part of the broader network, but a separate sub-network like NVLink or CXL.</li> <li>Many folks dislike its scalability constraints (connections need QPs need NIC SRAM).</li> </ol> <h2 id="what-we-really-need-rd--ethernet-compatibility">What We Really Need: RD + Ethernet Compatibility</h2> <h3 id="case-study-qlogic">Case Study: QLogic</h3> <p>QLogic already had this insight 15 years <a href="https://www.youtube.com/watch?v=E0uSl_gyZnI" rel="external nofollow noopener" target="_blank">ago</a>. No one knows about QLogic, and I think it is unfortunate. We keep bringing up a debate that we do not understand the history of.</p> <p>QLogic Truescale was the precursor to Intel Omnipath, which was the precursor to Cornelis Networks. Instead of offload, they wanted <em>onload</em>: CPU-mediated communication for scalability. It was a verbs-compliant fabric that natively spoke a different interface called <a href="https://github.com/pdlfs/psm" rel="external nofollow noopener" target="_blank">psm</a>.</p> <p>PSM was a messaging-oriented fabric. I think of it as RDMA UD with variable message sizes. It injected small payloads inline, and large payloads were DMA’ed on both the send and receive paths using transient connection mechanisms called TID/TIDflows.</p> <p>From what I understand, PSM had CBFC but no <em>link-level retry</em> (LLR). It had a software-based go-back-N-style recovery. I think link-level retry requires a smarter HCA, which they were trying to avoid, at least for the first generation. Software-based retries in that fabric do add an extraordinary amount of jitter because of arbitrary timeouts, but they’re triggered because of some other fabric/driver bugs, and not because of packet drops.</p> <h3 id="case-study-srd-in-amazon-efa">Case Study: SRD in Amazon EFA</h3> <p>The variable-sized datagram design point remains compelling. Amazon built a fabric called <em>Elastic Fabric Adapter (EFA)</em> that presumably adds LLR to UD. I don’t know much about it so I’ll keep it short.</p> <h2 id="rdma-vs-rpcs-a-false-dichotomy">RDMA vs RPCs: A False Dichotomy</h2> <p>I’m probably wading into a decade-old debate at this point, but it’s not my fault that I was just a swaddling infant a decade ago.</p> <p>Let us take eRPC<sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>, an iconic paper at this point. The argument I will make is that eRPC implements Infiniband in software over lossy ethernet, and while a solid step forward for lossy ethernet, its design just strengthens the argument for <em>real RDMA/infiniband</em>.</p> <ol> <li>eRPC likes losslessness. They create those conditions by having session credits and limiting dispatched traffic to network BDP. Session credits are basically end-to-end CBFC (also tried in <sup id="fnref:3"><a href="#fn:3" class="footnote" rel="footnote" role="doc-noteref">3</a></sup>), and limiting dispatched traffic is the equivalent of the software layer making a decision that the flow control layer would’ve made for you anyway in a lossless fabric.</li> <li>eRPC likes contiguous message buffers, an event loop for short messages, and memcpy’ed contiguous buffers for large messages, with memcpy orchestrated by CPU. These are just RDMA semantics, but using CPU cycles instead.</li> </ol> <p>I think infiniband already exists, enabling both losslessness and CPU cycle-saving DMA. I think scalability issues as criticisms of infiniband also exist already, with in-production DMA-based fabrics that do not share those concerns. libfabric RxD is an example of multiplexing over UD in software on top of plain old infiniband.</p> <p>Next, I think RDMA doesn’t preclude the ability to do two-sided communication. The Mercury RPC library<sup id="fnref:5"><a href="#fn:5" class="footnote" rel="footnote" role="doc-noteref">4</a></sup>, with providers for libfabric etc, provides both messaging-style semantics for small messages and verbs-enabled RDMA via a <em>bulk</em> interface for large messages.</p> <p>Finally, I think the end-to-end argument does not preclude merging of layers for performance. I think it is a neat guiding principle for what to do in the absence of competing concerns, but it does not preemptively override the presence of competing concerns.</p> <h2 id="whats-next">What’s Next?</h2> <p>I want to understand HPE Slingshot and UltraEthernet better, and maybe also start dabbling with CXL.</p> <p>Side note: do you know PCIe uses CBFC? I think the gap between an interconnect, a fabric, and a network is smaller than we think, and loss-based mechanisms receive more academic attention than they should.</p> <h2 id="references">References</h2> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:2"> <p>Homa: A receiver-driven low-latency transport protocol using network priorities, <em>SIGCOMM ‘18: ACM SIGCOMM 2018 Conference</em>, https://dl.acm.org/doi/10.1145/3230543.3230564 <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:1"> <p>Datacenter RPCs can be General and Fast, <em>16th USENIX Symposium on Networked Systems Design and Implementation (NSDI 19)</em>, https://www.usenix.org/conference/nsdi19/presentation/kalia <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:3"> <p>Harmony: A Congestion-free Datacenter Architecture, <em>21st USENIX Symposium on Networked Systems Design and Implementation (NSDI 24)</em>, https://www.usenix.org/conference/nsdi24/presentation/agarwal-saksham <a href="#fnref:3" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:5"> <p>Mercury: Enabling remote procedure call for high-performance computing, <em>2013 IEEE International Conference on Cluster Computing (CLUSTER)</em>, http://ieeexplore.ieee.org/document/6702617/ <a href="#fnref:5" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </div> </article><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"anku94/giscus-discussions","data-repo-id":"R_kgDOKSSNEA","data-category":"General","data-category-id":"DIC_kwDOKSSNEM4CZPRA","data-mapping":"url","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Ankush Jain. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-T2LNMMYJL6"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-T2LNMMYJL6");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>